@startuml
skinparam monochrome true
skinparam packageStyle rectangle
skinparam shadowing false

title US024 - Postpone an entry in the agenda

autonumber

actor "GSM" as Employee
participant ":PostponeEntryUI" as UI
participant ":PostponeEntryController" as CTRL
participant ":ApplicationSession" as _APP
participant "appSession\n:ApplicationSession" as APP
participant "currentSession\n:UserSession" as SESSION
participant ":Repositories" as RepositorySingleton
participant "repositories\n:Repositories" as PLAT
participant "greenSpaceRepository\n:GreenSpaceRepository" as GreenSpaceRepository
participant "greenSpacesList\n:List<GreenSpace>" as greenSpacesList
participant "greenSpaceMapper\n:GreenSpaceMapper" as GreenSpaceMapper
participant "greenSpace\n:GreenSpace" as greenSpace
participant "GSMGreenSpacesList\n:List<GreenSpace>" as GSMGreenSpacesList
participant "GSMGreenSpacesListDto\n:List<GreenSpaceDto>" as GSMGreenSpacesListDto
participant "greenSpaceDTO\n:GreenSpaceDTO" as greenSpaceDTO
participant "taskMapper\n:TaskMapper" as TaskMapper
participant "agenda\n:Agenda" as Agenda
participant "entriesList\n:List<Task>" as entriesList
participant "entriesListByGreenSpace\n:List<Task>" as entriesListByGreenSpace
participant "task\n:Task" as task
participant "entriesListByGreenSpaceDTO\n:List<TaskDTO>" as entriesListByGreenSpaceDTO
participant "taskRepository\n:TaskRepository" as TaskRepository
participant "taskDTO\n:TaskDTO" as TaskDTO


activate Employee

    Employee -> UI : asks to postpone an entry in the agenda
    activate UI

    UI --> CTRL** : create()
            UI -> CTRL : getGreenSpaces()
            activate CTRL

                CTRL -> _APP: getInstance()
                    activate _APP
                        _APP -> CTRL: appSession
                    deactivate _APP

                    CTRL -> APP: getCurrentSession()
                    activate APP

                        APP --> CTRL: currentSession
                    deactivate APP

                    CTRL -> SESSION: email = getUserEmail()
                    activate SESSION

                        SESSION --> CTRL: email
                    deactivate SESSION

                CTRL -> RepositorySingleton : getInstance()
                    activate RepositorySingleton

                        RepositorySingleton --> CTRL: repositories
                    deactivate RepositorySingleton

                    CTRL -> PLAT : getGreenSpaceRepository()
                    activate PLAT

                        PLAT --> CTRL : greenSpaceRepository
                    deactivate PLAT

                    CTRL -> GreenSpaceRepository : getGreenSpaces(email)
                    activate GreenSpaceRepository

                        GreenSpaceRepository --> GSMGreenSpacesList** : create()

                        loop for each known Green Space
                            GreenSpaceRepository -> greenSpacesList : greenSpace = get(i)
                            activate greenSpacesList
                            deactivate greenSpacesList

                            GreenSpaceRepository -> greenSpace : GSM = hasUserEmail(email)
                            activate greenSpace
                            deactivate greenSpace

                            opt hasUserEmail
                                GreenSpaceRepository -> GSMGreenSpacesList : add(greenSpace)
                                activate GSMGreenSpacesList
                                deactivate GSMGreenSpacesList
                            end opt

                        end loop

                        GreenSpaceRepository --> CTRL : GSMGreenSpacesList
                    deactivate GreenSpaceRepository

                    CTRL -> GreenSpaceMapper : toDTO(associatedGreenSpacesList)
                    activate GreenSpaceMapper

                        GreenSpaceMapper --> GSMGreenSpacesListDto** : create()

                        loop for each object in GSMGreenSpacesList
                            GreenSpaceMapper -> GSMGreenSpacesList : obj = get(i)
                            activate GSMGreenSpacesList

                                deactivate GSMGreenSpacesList

                            GreenSpaceMapper -> GreenSpaceMapper : objDto = toDTO(obj)
                            activate GreenSpaceMapper

                                GreenSpaceMapper -> greenSpaceDTO** :create(...)
                                deactivate GreenSpaceMapper

                            GreenSpaceMapper -> GSMGreenSpacesListDto : add(objDto)
                            activate GSMGreenSpacesListDto

                                deactivate GSMGreenSpacesListDto

                            end loop

                        GreenSpaceMapper --> CTRL : GSMGreenSpacesListDto
                        deactivate GreenSpaceMapper

                    CTRL --> UI : GSMGreenSpacesListDto
                    deactivate CTRL

    UI --> Employee : shows list of green spaces to select one
    deactivate UI

    Employee -> UI : selects one green space
    activate UI

    UI -> CTRL : getEntriesByGreenSpace()
    activate CTRL

            CTRL -> PLAT : getAgenda()
            activate PLAT

            PLAT --> CTRL : agenda
            deactivate PLAT

            CTRL -> Agenda : getAgendaEntries(greenSpace)
            activate Agenda

            Agenda --> entriesListByGreenSpace** : create()

            loop for each known task

            Agenda -> entriesList : entry = get(i)
            activate entriesList
            deactivate entriesList

            Agenda -> task : taskGreenSpace = greenSpace
            activate task
            deactivate task

            opt greenSpace == true
            Agenda -> entriesListByGreenSpace : add(entry)
            activate entriesListByGreenSpace
            deactivate entriesListByGreenSpace
            end opt

            end loop

            Agenda --> CTRL : entriesListByGreenSpace
            deactivate Agenda

            CTRL -> TaskMapper : toDTO(entriesList)
            activate TaskMapper

            TaskMapper --> entriesListByGreenSpaceDTO** : create()

            loop for each task in entriesListByGreenSpace

            TaskMapper -> entriesListByGreenSpace : obj = get(i)
            activate entriesListByGreenSpace
            deactivate entriesListByGreenSpace

            TaskMapper -> TaskMapper : objDto = toDTO(obj)
            activate TaskMapper

            TaskMapper -> TaskDTO** : create(...)
            deactivate TaskMapper

            TaskMapper -> entriesListByGreenSpaceDTO : add(objDto)
            activate entriesListByGreenSpaceDTO
            deactivate entriesListByGreenSpaceDTO

            end loop

            TaskMapper --> CTRL : entriesListByGreenSpaceDTO
            deactivate TaskMapper

            CTRL --> UI : entriesListByGreenSpaceDTO
            deactivate CTRL

    UI --> Employee : shows list of entries in the agenda of the selected green space
    deactivate UI

    Employee -> UI : selects one entry
    activate UI

    UI --> Employee : requests the new date
    deactivate UI

    Employee -> UI : types the new date
    activate UI

    UI -> CTRL : postponeEntry(taskDTO, newDate)
    activate CTRL

    CTRL --> CTRL : validateNewDate(newDate)
    CTRL -> TaskRepository : postponeEntry(taskDTO, newDate)
    activate TaskRepository

    TaskRepository -> TaskDTO : postponeEntry(taskDTO, newDate)
    activate TaskDTO

    TaskDTO --> TaskRepository : taskDTO
    deactivate TaskDTO

    TaskRepository --> CTRL : taskDTO
    deactivate TaskRepository

    CTRL --> UI : taskDTO
    deactivate CTRL

    UI --> Employee : displays operation success
    deactivate UI

deactivate Employee

@enduml